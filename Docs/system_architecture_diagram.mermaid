graph TB
    subgraph "ğŸŒ User Interface Layer"
        UI[Web Interface<br/>File Upload & Selection]
        CONFIG[Model Configuration<br/>OpenAI/Gemini Preference]
    end
    
    subgraph "ğŸ¯ Agentic Orchestration Layer"
        ORCH[ExamProcessingOrchestrator<br/>Workflow Coordination]
        
        subgraph "ğŸ¤– Intelligent Agents"
            DOC[DocumentAnalyzer<br/>ğŸ“Š Quality Assessment<br/>ğŸ§  Model Selection]
            QUEST[QuestionExtractor<br/>ğŸ“‹ Question Identification<br/>âœ… Content Validation]
            ANS[AnswerProcessor<br/>ğŸ“ Handwriting Recognition<br/>ğŸ”— Question-Answer Mapping]
            LATEX[LatexCompiler<br/>âš™ï¸ PDF Generation<br/>ğŸ”§ Error Recovery]
        end
    end
    
    subgraph "ğŸ§  AI Model Layer"
        OPENAI[OpenAI GPT-4V<br/>ğŸ¯ High Precision<br/>ğŸ“„ Structured Text]
        GEMINI[Google Gemini 2.0<br/>âš¡ Fast Processing<br/>âœï¸ Handwriting OCR]
    end
    
    subgraph "ğŸ›¡ï¸ Fallback System"
        ENHANCED[Enhanced Methods<br/>ğŸ“ˆ Better Prompts<br/>ğŸ”„ Retry Logic]
        LEGACY[Legacy Processing<br/>ğŸ”§ Original Methods<br/>ğŸ“„ Basic Extraction]
        EMERGENCY[Emergency Fallback<br/>ğŸ“‹ Structured Documents<br/>ğŸš¨ Error Reports]
    end
    
    subgraph "ğŸ’¾ Storage & Output"
        TEMP[Temporary Storage<br/>ğŸ–¼ï¸ Image Conversion<br/>ğŸ“ Processing Files]
        OUTPUT[Final Output<br/>ğŸ“„ Generated PDFs<br/>ğŸ“Š Results Display]
        META[Metadata<br/>ğŸ“‹ File Organization<br/>ğŸ“ˆ Success Tracking]
    end
    
    %% Main Flow
    UI --> ORCH
    CONFIG --> ORCH
    ORCH --> DOC
    DOC --> QUEST
    QUEST --> ANS
    ANS --> LATEX
    
    %% AI Model Connections
    DOC -.->|Intelligent Selection| OPENAI
    DOC -.->|Intelligent Selection| GEMINI
    QUEST -.->|Dynamic Choice| OPENAI
    QUEST -.->|Dynamic Choice| GEMINI
    ANS -.->|Adaptive Processing| OPENAI
    ANS -.->|Adaptive Processing| GEMINI
    
    %% Fallback Connections
    QUEST -.->|If AI Fails| ENHANCED
    ANS -.->|If AI Fails| ENHANCED
    ENHANCED -.->|If Enhanced Fails| LEGACY
    LEGACY -.->|If All Fails| EMERGENCY
    
    %% Storage Connections
    ORCH --> TEMP
    LATEX --> OUTPUT
    ORCH --> META
    
    %% Success Path
    LATEX --> UI
    
    %% Styling
    classDef agent fill:#e8f5e8,stroke:#4caf50,stroke-width:2px
    classDef ai fill:#e3f2fd,stroke:#2196f3,stroke-width:2px
    classDef fallback fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    classDef storage fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
    classDef ui fill:#e1f5fe,stroke:#00bcd4,stroke-width:2px
    
    class DOC,QUEST,ANS,LATEX agent
    class OPENAI,GEMINI ai
    class ENHANCED,LEGACY,EMERGENCY fallback
    class TEMP,OUTPUT,META storage
    class UI,CONFIG ui